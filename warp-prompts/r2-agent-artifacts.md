# R2 Agent Artifacts Management - Warp Integration Prompt

## Context
You are helping manage agent artifacts in the CrapGPT platform using Cloudflare R2. Agent artifacts include generated content, memories, task completions, and other outputs from AI agents.

## Agent Artifact Structure
```
bucket/agents/{agentId}/
├── memories/           # Agent memory storage
│   └── {memoryId}.json
├── artifacts/          # Generated content (images, files, etc.)
│   ├── {taskId}_image_0.jpg
│   ├── {taskId}_file_0.dat
│   └── {taskId}_data.json
├── structured-memories/ # Enhanced memory with metadata
│   └── {memoryId}.json
└── task-completions/    # Completed task logs
    └── {taskId}.json
```

## Commands to Help With

### 1. List Agent Artifacts
```bash
# List all artifacts for a specific agent
crapgpt-agent-artifacts() {
  local agent_id="$1"
  
  if [ -z "$agent_id" ]; then
    echo "❌ Please provide an agent ID"
    return 1
  fi
  
  echo "🤖 Listing artifacts for agent: $agent_id"
  
  # This would typically use a custom API endpoint
  curl -s -X GET "$CRAPGPT_API_URL/api/agent/$agent_id/artifacts" \
    -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN" \
    -H "Content-Type: application/json" | jq -r '
      .artifacts[] |
      "🆔 \(.key)
      📁 \(.type)
      📏 \(.size) bytes
      🕐 \(.lastModified)
      🔗 \(.downloadUrl)
      "
    '
}

# List agent memories
crapgpt-agent-memories() {
  local agent_id="$1"
  local memory_type="${2:-all}"
  
  if [ -z "$agent_id" ]; then
    echo "❌ Please provide an agent ID"
    return 1
  fi
  
  echo "🧠 Listing $memory_type memories for agent: $agent_id"
  
  curl -s -X GET "$CRAPGPT_API_URL/api/agent/$agent_id/memories?type=$memory_type" \
    -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN" \
    -H "Content-Type: application/json" | jq -r '
      .memories[] |
      "🆔 \(.id)
      💭 \(.input | .[0:100])...
      🗣️ \(.output | .[0:100])...
      📊 Importance: \(.importance)
      🕐 \(.timestamp)
      "
    '
}
```

### 2. Download Agent Generated Images
```bash
# Download all images generated by an agent for a specific task
crapgpt-download-agent-images() {
  local agent_id="$1"
  local task_id="$2"
  local output_dir="${3:-./agent-images}"
  
  if [ -z "$agent_id" ] || [ -z "$task_id" ]; then
    echo "❌ Please provide agent ID and task ID"
    return 1
  fi
  
  mkdir -p "$output_dir"
  echo "🎨 Downloading images for agent $agent_id, task $task_id to $output_dir"
  
  # Get list of artifacts for the task
  response=$(curl -s -X GET "$CRAPGPT_API_URL/api/agent/$agent_id/artifacts?taskId=$task_id&type=image" \
    -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN" \
    -H "Content-Type: application/json")
  
  # Download each image
  echo "$response" | jq -r '.artifacts[] | select(.type == "image") | .downloadUrl + " " + .originalName' | \
  while read -r url filename; do
    if [ -n "$url" ] && [ "$url" != "null" ]; then
      echo "📥 Downloading $filename..."
      curl -s "$url" -o "$output_dir/$filename"
      echo "✅ Downloaded $filename"
    fi
  done
}
```

### 3. Export Agent Memory as JSON
```bash
# Export all agent memories to a JSON file
crapgpt-export-agent-memory() {
  local agent_id="$1"
  local output_file="${2:-agent-${agent_id}-memory.json}"
  
  if [ -z "$agent_id" ]; then
    echo "❌ Please provide an agent ID"
    return 1
  fi
  
  echo "💾 Exporting memory for agent $agent_id to $output_file"
  
  curl -s -X GET "$CRAPGPT_API_URL/api/agent/$agent_id/export-memory" \
    -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN" \
    -H "Content-Type: application/json" | jq '.' > "$output_file"
  
  echo "✅ Memory exported to $output_file"
  echo "📊 $(cat "$output_file" | jq '.memories | length') memories exported"
}
```

### 4. Backup Agent Artifacts
```bash
# Create a complete backup of all agent artifacts
crapgpt-backup-agent() {
  local agent_id="$1"
  local backup_dir="${2:-./backups/agent-$agent_id-$(date +%Y%m%d-%H%M%S)}"
  
  if [ -z "$agent_id" ]; then
    echo "❌ Please provide an agent ID"
    return 1
  fi
  
  mkdir -p "$backup_dir"
  echo "💼 Creating backup for agent $agent_id in $backup_dir"
  
  # Export memories
  echo "🧠 Backing up memories..."
  crapgpt-export-agent-memory "$agent_id" "$backup_dir/memories.json"
  
  # Download artifacts
  echo "🎨 Backing up artifacts..."
  response=$(curl -s -X GET "$CRAPGPT_API_URL/api/agent/$agent_id/artifacts" \
    -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN" \
    -H "Content-Type: application/json")
  
  # Create artifacts directory
  mkdir -p "$backup_dir/artifacts"
  
  # Download each artifact
  echo "$response" | jq -r '.artifacts[] | .downloadUrl + " " + .key' | \
  while read -r url key; do
    if [ -n "$url" ] && [ "$url" != "null" ]; then
      filename=$(basename "$key")
      echo "📥 Downloading $filename..."
      curl -s "$url" -o "$backup_dir/artifacts/$filename"
    fi
  done
  
  # Create backup manifest
  cat << EOF > "$backup_dir/manifest.json"
{
  "agentId": "$agent_id",
  "backupDate": "$(date -Iseconds)",
  "backupPath": "$backup_dir",
  "contents": {
    "memories": "memories.json",
    "artifacts": "artifacts/"
  }
}
EOF
  
  echo "✅ Backup completed: $backup_dir"
}
```

### 5. Clean Old Agent Artifacts
```bash
# Clean old agent artifacts (older than specified days)
crapgpt-clean-agent-artifacts() {
  local agent_id="$1"
  local days_old="${2:-30}"
  local dry_run="${3:-true}"
  
  if [ -z "$agent_id" ]; then
    echo "❌ Please provide an agent ID"
    return 1
  fi
  
  echo "🧹 Cleaning artifacts older than $days_old days for agent $agent_id"
  
  if [ "$dry_run" = "true" ]; then
    echo "🔍 DRY RUN - no files will be deleted"
  fi
  
  # Get old artifacts
  cutoff_date=$(date -d "$days_old days ago" -Iseconds)
  response=$(curl -s -X GET "$CRAPGPT_API_URL/api/agent/$agent_id/artifacts?olderThan=$cutoff_date" \
    -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN" \
    -H "Content-Type: application/json")
  
  old_artifacts=$(echo "$response" | jq -r '.artifacts[] | .key')
  
  if [ -z "$old_artifacts" ]; then
    echo "✨ No old artifacts found"
    return 0
  fi
  
  echo "🗑️  Found $(echo "$old_artifacts" | wc -l) old artifacts:"
  echo "$old_artifacts"
  
  if [ "$dry_run" != "true" ]; then
    echo "⚠️  Deleting old artifacts..."
    for artifact in $old_artifacts; do
      curl -s -X DELETE "$CRAPGPT_API_URL/api/artifacts/$artifact" \
        -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN"
      echo "🗑️  Deleted $artifact"
    done
    echo "✅ Cleanup completed"
  else
    echo "💡 Run with dry_run=false to actually delete files:"
    echo "   crapgpt-clean-agent-artifacts $agent_id $days_old false"
  fi
}
```

## Usage Examples

```bash
# List all artifacts for agent "assistant-123"
crapgpt-agent-artifacts assistant-123

# List only structured memories for agent
crapgpt-agent-memories assistant-123 structured

# Download all images from task "task-456"
crapgpt-download-agent-images assistant-123 task-456 ./downloads

# Export agent memory to JSON
crapgpt-export-agent-memory assistant-123 assistant-memory.json

# Create complete agent backup
crapgpt-backup-agent assistant-123 ./backup-assistant

# Clean artifacts older than 7 days (dry run)
crapgpt-clean-agent-artifacts assistant-123 7 true

# Actually clean old artifacts
crapgpt-clean-agent-artifacts assistant-123 7 false
```

## Advanced Agent Artifact Operations

### 6. Search Agent Artifacts by Content
```bash
# Search for specific content in agent artifacts
crapgpt-search-agent-artifacts() {
  local agent_id="$1"
  local search_term="$2"
  
  if [ -z "$agent_id" ] || [ -z "$search_term" ]; then
    echo "❌ Please provide agent ID and search term"
    return 1
  fi
  
  echo "🔍 Searching for '$search_term' in agent $agent_id artifacts..."
  
  curl -s -X POST "$CRAPGPT_API_URL/api/agent/$agent_id/search" \
    -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN" \
    -H "Content-Type: application/json" \
    -d "{\"query\": \"$search_term\", \"type\": \"artifacts\"}" | jq -r '
      .results[] |
      "📄 \(.artifact)
      🔍 Match: \(.snippet)
      📊 Score: \(.score)
      🔗 \(.downloadUrl)
      "
    '
}
```

### 7. Generate Agent Performance Report
```bash
# Generate performance report for an agent
crapgpt-agent-report() {
  local agent_id="$1"
  local days="${2:-30}"
  local output_file="${3:-agent-${agent_id}-report.json}"
  
  if [ -z "$agent_id" ]; then
    echo "❌ Please provide an agent ID"
    return 1
  fi
  
  echo "📊 Generating $days-day performance report for agent $agent_id"
  
  curl -s -X POST "$CRAPGPT_API_URL/api/agent/$agent_id/report" \
    -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN" \
    -H "Content-Type: application/json" \
    -d "{\"days\": $days}" > "$output_file"
  
  echo "✅ Report saved to $output_file"
  
  # Display summary
  echo "📈 Summary:"
  cat "$output_file" | jq -r '
    "💭 Total memories: \(.memoryStats.total)
    🎨 Artifacts created: \(.artifactStats.total)
    ✅ Tasks completed: \(.taskStats.completed)
    ⏱️ Avg response time: \(.performance.avgResponseTime)ms
    🎯 Success rate: \(.performance.successRate)%"
  '
}
```

## Monitor Agent Activity in Real-time

### 8. Watch Agent Activity
```bash
# Watch real-time agent activity
crapgpt-watch-agent() {
  local agent_id="$1"
  local interval="${2:-5}"
  
  if [ -z "$agent_id" ]; then
    echo "❌ Please provide an agent ID"
    return 1
  fi
  
  echo "👁️  Watching agent $agent_id activity (refreshing every ${interval}s)"
  echo "Press Ctrl+C to stop"
  
  while true; do
    clear
    echo "🤖 Agent $agent_id - $(date)"
    echo "=================================="
    
    # Get recent activity
    curl -s -X GET "$CRAPGPT_API_URL/api/agent/$agent_id/activity" \
      -H "Authorization: Bearer $CRAPGPT_JWT_TOKEN" \
      -H "Content-Type: application/json" | jq -r '
        .recentActivity[] |
        "🕐 \(.timestamp) | \(.type) | \(.status)
        💭 \(.details)
        "
      ' | head -20
    
    sleep "$interval"
  done
}
```

## Security Notes for Agent Artifacts

- Agent artifacts may contain sensitive AI-generated content
- Always verify agent identity before accessing artifacts
- Memory exports should be handled securely and encrypted if needed
- Task completions contain execution logs that may reveal system information
- Use proper access controls when sharing agent artifacts with team members

## Best Practices

1. **Regular Backups**: Backup important agent artifacts regularly
2. **Memory Management**: Clean old memories to prevent storage bloat
3. **Artifact Organization**: Use consistent naming for easy retrieval
4. **Performance Monitoring**: Generate regular performance reports
5. **Security Auditing**: Monitor artifact access and downloads